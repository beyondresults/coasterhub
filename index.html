<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <link rel="icon" type="image/svg+xml" href="/vite.svg" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Poaster Coaster</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@400;500;600;700&display=swap" rel="stylesheet">
    <style>
      body {
        font-family: 'Poppins', sans-serif;
      }
      .hidden {
        display: none;
      }
      #custom-month-select-button[aria-expanded="true"] > #custom-month-select-arrow {
        transform: rotate(180deg);
      }
    </style>
  </head>
  <body class="bg-[#F6E9D7] min-h-screen antialiased text-gray-800">
    <div id="app-container" class="container mx-auto max-w-md p-4 space-y-6">
      
      <!-- Header -->
      <header>
        <div class="bg-white rounded-2xl p-6 shadow-lg flex items-center space-x-4">
          <img id="pub-logo" src="" alt="Pub logo" class="w-16 h-16 rounded-2xl shadow-md flex-shrink-0" />
          <div>
            <p class="text-sm text-gray-500 -mb-1">Welcome to</p>
            <h1 id="pub-name" class="text-2xl font-bold text-[#004225]"></h1>
            <p id="pub-address" class="text-sm text-gray-500"></p>
            <div class="flex items-center space-x-3 mt-2">
              <a id="pub-instagram-link" href="#" target="_blank" rel="noopener noreferrer" aria-label="Instagram" class="text-gray-500 hover:text-gray-800 transition-colors">
                <svg class="w-5 h-5" fill="currentColor" viewBox="0 0 24 24" aria-hidden="true"><path fill-rule="evenodd" d="M12.315 2c2.43 0 2.784.013 3.808.06 1.064.049 1.791.218 2.427.465a4.902 4.902 0 011.772 1.153 4.902 4.902 0 011.153 1.772c.247.636.416 1.363.465 2.427.048 1.024.06 1.378.06 3.808s-.012 2.784-.06 3.808c-.049 1.064-.218 1.791-.465 2.427a4.902 4.902 0 01-1.153 1.772 4.902 4.902 0 01-1.772 1.153c-.636.247-1.363.416-2.427.465-1.024.048-1.378.06-3.808.06s-2.784-.012-3.808-.06c-1.064-.049-1.791-.218-2.427-.465a4.902 4.902 0 01-1.772-1.153 4.902 4.902 0 01-1.153-1.772c-.247-.636-.416-1.363-.465-2.427-.048-1.024-.06-1.378-.06-3.808s.012-2.784.06-3.808c.049-1.064.218-1.791.465-2.427a4.902 4.902 0 011.153-1.772A4.902 4.902 0 016.08 2.525c.636-.247 1.363-.416 2.427.465C9.53 2.013 9.884 2 12.315 2zM12 7.177a4.823 4.823 0 100 9.646 4.823 4.823 0 000-9.646zm0 7.94a3.117 3.117 0 110-6.234 3.117 3.117 0 010 6.234zm6.09-8.23a1.147 1.147 0 10-2.294 0 1.147 1.147 0 002.294 0z" clip-rule="evenodd" /></svg>
              </a>
              <a id="pub-facebook-link" href="#" target="_blank" rel="noopener noreferrer" aria-label="Facebook" class="text-gray-500 hover:text-gray-800 transition-colors">
                <svg class="w-5 h-5" fill="currentColor" viewBox="0 0 24 24" aria-hidden="true"><path fill-rule="evenodd" d="M22 12c0-5.523-4.477-10-10-10S2 6.477 2 12c0 4.991 3.657 9.128 8.438 9.878v-6.987h-2.54V12h2.54V9.797c0-2.506 1.492-3.89 3.777-3.89 1.094 0 2.238.195 2.238.195v2.46h-1.26c-1.243 0-1.63.771-1.63 1.562V12h2.773l-.443 2.89h-2.33v6.988C18.343 21.128 22 16.991 22 12z" clip-rule="evenodd" /></svg>
              </a>
            </div>
          </div>
        </div>
      </header>
      
      <main class="space-y-6">

        <!-- Stop The Clock Game -->
        <div class="bg-white rounded-2xl p-6 shadow-lg text-center">
          <div class="mx-auto bg-pink-100 w-16 h-16 rounded-2xl flex items-center justify-center mb-4">
              <span class="text-4xl">‚è±Ô∏è</span>
          </div>
          <h2 class="text-2xl font-bold text-gray-800 mb-2">Stop at 10 to Win!</h2>
          <p class="text-gray-600 mb-6">Think you have perfect timing? Stop it bang on 10.00 and score a FREE drink!</p>
          
          <div class="bg-gray-100 rounded-xl p-4 my-6">
            <p id="stop-clock-timer" class="text-6xl font-bold font-mono text-gray-800 select-none">0.00</p>
          </div>
          <p id="stop-clock-result" class="text-lg font-semibold mb-4 min-h-[1.5em]"></p>
          
          <button id="stop-clock-button" class="w-full bg-pink-500 text-white font-bold py-3 px-4 rounded-xl shadow-lg hover:bg-pink-600 transition-colors active:scale-95 disabled:bg-gray-400 disabled:cursor-not-allowed">
            Start
          </button>
          <button id="show-stop-clock-terms-button" class="text-xs text-gray-400 mt-4 underline hover:text-gray-600 transition-colors">Terms & Conditions apply.</button>
        </div>

        <!-- Spin Wheel Card -->
        <div class="bg-white rounded-2xl p-6 shadow-lg text-center">
            <div class="mx-auto bg-purple-100 w-16 h-16 rounded-2xl flex items-center justify-center mb-4">
                <span class="text-4xl">üèÜ</span>
            </div>
            <h2 class="text-2xl font-bold text-gray-800 mb-2">Spin to Win!</h2>
            <p class="text-gray-600 mb-6">Spin the wheel to win an instant prize!</p>

            <div id="wheel-container" class="relative w-[280px] h-[280px] mx-auto mb-6">
                <!-- SVG Pointer -->
                <div class="absolute -top-1 left-1/2 -translate-x-1/2 z-20 drop-shadow-lg">
                    <svg width="40" height="50" viewBox="0 0 40 50">
                        <path d="M20 50 C 25 40, 25 40, 30 30 L 30 10 Q 30 0, 20 0 Q 10 0, 10 10 L 10 30 C 15 40, 15 40, 20 50 Z" fill="#b91c1c"></path>
                        <circle cx="20" cy="15" r="5" fill="#fef2f2"></circle>
                    </svg>
                </div>
                <!-- SVG Wheel -->
                <div id="wheel" class="w-full h-full transition-transform duration-[5000ms] ease-[cubic-bezier(0.1,0,0.25,1)]">
                    <svg viewBox="0 0 200 200" class="w-full h-full rounded-full shadow-xl">
                        <g id="wheel-segments" transform="rotate(-90 100 100)">
                            <!-- Visually 25% -->
                            <path d="M100,100 L100,0 A100,100 0 0,1 200,100 z" fill="#ef4444"></path>
                            <!-- Visually 25% -->
                            <path d="M100,100 L200,100 A100,100 0 0,1 100,200 z" fill="#f97316"></path>
                             <!-- Visually 25% -->
                            <path d="M100,100 L100,200 A100,100 0 0,1 0,100 z" fill="#3b82f6"></path>
                            <!-- Visually 25% -->
                            <path d="M100,100 L0,100 A100,100 0 0,1 100,0 z" fill="#8b5cf6"></path>
                        </g>

                        <!-- Center Hub -->
                        <circle cx="100" cy="100" r="20" fill="white" stroke="#e5e7eb" stroke-width="4"></circle>
                        <circle cx="100" cy="100" r="15" fill="#e5e7eb" stroke="#d1d5db" stroke-width="2"></circle>
                    </svg>
                </div>
            </div>

            <button id="spin-button" class="w-full bg-purple-600 text-white font-bold py-3 px-4 rounded-xl shadow-lg hover:bg-purple-700 active:scale-95 transition-all disabled:bg-gray-400 disabled:active:scale-100">
                Spin!
            </button>
            <button id="show-spin-wheel-terms-button" class="text-xs text-gray-400 mt-4 underline hover:text-gray-600 transition-colors">Terms & Conditions apply.</button>
        </div>

        <!-- Trivia Game -->
        <div class="bg-white rounded-2xl p-6 shadow-lg">
          <!-- Start Screen -->
          <div id="trivia-start-screen" class="text-center">
            <div class="mx-auto bg-green-100 w-16 h-16 rounded-2xl flex items-center justify-center mb-4">
              <span class="text-4xl">üé≤</span>
            </div>
            <h2 class="text-2xl font-bold text-gray-800 mb-2">Weekly Trivia</h2>
            <p class="text-gray-500 mb-2">Challenge your mates to to trivia. This week's trivia theme is:</p>
            <p class="text-gray-800 font-semibold text-lg mb-6">AFL (Australian Football League)</p>
            <button id="start-trivia-button" class="w-full bg-[#004225] text-white font-bold py-3 px-4 rounded-xl shadow-lg hover:bg-[#00351e] transition-colors">
              Start Trivia
            </button>
            <button id="show-trivia-terms-button" class="text-xs text-gray-400 mt-4 underline hover:text-gray-600 transition-colors">Terms & Conditions apply.</button>
          </div>
          
          <!-- Playing Screen -->
          <div id="trivia-playing-screen" class="hidden">
            <div class="flex justify-between items-center mb-4">
              <h2 class="text-lg font-bold text-[#004225]">Pub Trivia</h2>
              <div class="flex items-center space-x-3">
                <span id="trivia-timer" class="text-sm font-mono text-gray-500">0.00s</span>
                <span id="question-counter" class="text-sm font-semibold bg-gray-200 text-gray-700 px-3 py-1 rounded-full"></span>
              </div>
            </div>
            <p id="question-text" class="text-lg font-semibold text-gray-700 mb-6 min-h-[5em]"></p>
            <div id="answer-options" class="space-y-3"></div>
          </div>
          
          <!-- Finished Screen -->
          <div id="trivia-finished-screen" class="hidden text-center">
            <div class="mx-auto bg-yellow-100 w-16 h-16 rounded-2xl flex items-center justify-center mb-4">
              <span class="text-4xl">üëè</span>
            </div>
            <h2 class="text-2xl font-bold text-gray-800 mb-2">Trivia Complete!</h2>
            <p class="text-gray-600 mb-4">You scored</p>
            <p class="text-5xl font-bold text-[#004225] mb-1">
              <span id="final-score"></span> <span class="text-3xl text-gray-500">/ <span id="total-questions"></span></span>
            </p>
            <p id="score-percentage" class="font-semibold text-yellow-500 mb-2"></p>
            <p id="final-time-display" class="text-lg text-gray-600 mb-6"></p>
            <button id="play-again-button" class="w-full bg-[#004225] text-white font-bold py-3 px-4 rounded-xl shadow-lg hover:bg-[#00351e] transition-colors">
              Play Again
            </button>
          </div>
        </div>

        <!-- Birthday Club -->
        <div id="birthday-club-card" class="bg-white rounded-2xl p-6 shadow-lg text-center">
            <div id="birthday-initial-view">
                <div class="mx-auto bg-teal-100 w-16 h-16 rounded-2xl flex items-center justify-center mb-4">
                    <span class="text-4xl">üéÇ</span>
                </div>
                <h2 class="text-2xl font-bold text-gray-800 mb-2">Get a FREE Birthday Drink!</h2>
                <p class="text-gray-600 mb-6">We'll send you a voucher for a free drink during your birthday week!</p>
                <form id="birthday-form" class="space-y-4">
                    <input id="birthday-email" type="email" placeholder="Enter your email" required class="w-full p-3 border border-gray-300 rounded-xl focus:ring-2 focus:ring-[#004225] focus:border-transparent transition">
                    <div class="text-left">
                        <label for="birthday-month" class="text-sm font-medium text-gray-500 ml-1">Your Birthday:</label>
                        <div class="flex space-x-3 mt-1">
                            <!-- Custom Select Wrapper -->
                            <div class="relative w-2/3" id="custom-month-select">
                                <!-- Button that acts as the select box -->
                                <button type="button" id="custom-month-select-button" aria-haspopup="listbox" aria-expanded="false" class="w-full p-3 border border-gray-300 rounded-xl focus:ring-2 focus:ring-[#004225] focus:border-transparent transition bg-white text-left flex justify-between items-center text-gray-500">
                                    <span id="custom-month-select-value">Month</span>
                                    <svg id="custom-month-select-arrow" class="w-5 h-5 text-gray-400 transition-transform duration-200" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 20 20" fill="currentColor" aria-hidden="true">
                                      <path fill-rule="evenodd" d="M5.293 7.293a1 1 0 011.414 0L10 10.586l3.293-3.293a1 1 0 111.414 1.414l-4 4a1 1 0 01-1.414 0l-4-4a1 1 0 010-1.414z" clip-rule="evenodd" />
                                    </svg>
                                </button>
                                <!-- Dropdown options panel -->
                                <ul id="custom-month-select-options" class="hidden absolute z-10 w-full mt-1 bg-white shadow-lg max-h-60 rounded-xl py-1 text-base ring-1 ring-black ring-opacity-5 overflow-auto focus:outline-none sm:text-sm" tabindex="-1" role="listbox">
                                    <li class="text-gray-900 cursor-pointer select-none relative py-2 px-4 hover:bg-teal-100" role="option" data-value="1">January</li>
                                    <li class="text-gray-900 cursor-pointer select-none relative py-2 px-4 hover:bg-teal-100" role="option" data-value="2">February</li>
                                    <li class="text-gray-900 cursor-pointer select-none relative py-2 px-4 hover:bg-teal-100" role="option" data-value="3">March</li>
                                    <li class="text-gray-900 cursor-pointer select-none relative py-2 px-4 hover:bg-teal-100" role="option" data-value="4">April</li>
                                    <li class="text-gray-900 cursor-pointer select-none relative py-2 px-4 hover:bg-teal-100" role="option" data-value="5">May</li>
                                    <li class="text-gray-900 cursor-pointer select-none relative py-2 px-4 hover:bg-teal-100" role="option" data-value="6">June</li>
                                    <li class="text-gray-900 cursor-pointer select-none relative py-2 px-4 hover:bg-teal-100" role="option" data-value="7">July</li>
                                    <li class="text-gray-900 cursor-pointer select-none relative py-2 px-4 hover:bg-teal-100" role="option" data-value="8">August</li>
                                    <li class="text-gray-900 cursor-pointer select-none relative py-2 px-4 hover:bg-teal-100" role="option" data-value="9">September</li>
                                    <li class="text-gray-900 cursor-pointer select-none relative py-2 px-4 hover:bg-teal-100" role="option" data-value="10">October</li>
                                    <li class="text-gray-900 cursor-pointer select-none relative py-2 px-4 hover:bg-teal-100" role="option" data-value="11">November</li>
                                    <li class="text-gray-900 cursor-pointer select-none relative py-2 px-4 hover:bg-teal-100" role="option" data-value="12">December</li>
                                </ul>
                                <!-- Original hidden select for form submission -->
                                <select id="birthday-month" name="birthday-month" required class="hidden">
                                    <option value="" disabled selected>Month</option>
                                    <option value="1">January</option>
                                    <option value="2">February</option>
                                    <option value="3">March</option>
                                    <option value="4">April</option>
                                    <option value="5">May</option>
                                    <option value="6">June</option>
                                    <option value="7">July</option>
                                    <option value="8">August</option>
                                    <option value="9">September</option>
                                    <option value="10">October</option>
                                    <option value="11">November</option>
                                    <option value="12">December</option>
                                </select>
                            </div>
                            <!-- Day input remains the same -->
                            <input id="birthday-day" type="number" placeholder="Day" min="1" max="31" required class="w-1/3 p-3 border border-gray-300 rounded-xl focus:ring-2 focus:ring-[#004225] focus:border-transparent transition">
                        </div>
                    </div>
                    <p id="birthday-error" class="text-red-500 text-sm h-4"></p>
                    <button id="birthday-submit-button" type="submit" class="w-full bg-teal-500 text-white font-bold py-3 px-4 rounded-xl shadow-lg hover:bg-teal-600 transition-colors">
                        Sign Me Up!
                    </button>
                </form>
                <button id="show-terms-button" class="text-xs text-gray-400 mt-4 underline hover:text-gray-600 transition-colors">Terms & Conditions apply.</button>
            </div>
            <div id="birthday-thanks-view" class="hidden">
                <div class="mx-auto bg-teal-100 w-16 h-16 rounded-2xl flex items-center justify-center mb-4">
                    <span class="text-4xl">üéâ</span>
                </div>
                <h2 class="text-2xl font-bold text-gray-800 mb-2">You're all set!</h2>
                <p class="text-gray-600">Thanks for signing up! We'll send you a treat on your birthday week.</p>
            </div>
        </div>
        
        <!-- Instagram Card -->
        <div class="bg-white rounded-2xl p-6 shadow-lg text-center">
          <div class="mx-auto bg-gradient-to-br from-pink-500 via-red-500 to-yellow-500 text-white w-16 h-16 rounded-2xl flex items-center justify-center mb-4">
            <svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2">
              <rect width="20" height="20" x="2" y="2" rx="5" ry="5" />
              <path d="M16 11.37A4 4 0 1 1 12.63 8 4 4 0 0 1 16 11.37z" />
              <line x1="17.5" y1="6.5" x2="17.51" y2="6.5" />
            </svg>
          </div>
          <h2 class="text-2xl font-bold text-gray-800 mb-2">Join the photo wall</h2>
          <p class="text-gray-600 mb-4">
            Post a photo and tag <span id="pub-instagram-handle" class="font-semibold"></span> to be featured on our page.
          </p>
          <div class="space-y-3">
            <button id="copy-handle-button" class="w-full flex items-center justify-center bg-gray-100 text-gray-700 font-semibold py-3 px-4 rounded-xl hover:bg-gray-200 transition-colors">
              <span id="copy-icon-wrapper">
                <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5 mr-2" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2">
                  <rect width="13" height="13" x="9" y="9" rx="2" ry="2" />
                  <path d="M5 15H4a2 2 0 0 1-2-2V4a2 2 0 0 1 2-2h9a2 2 0 0 1 2 2v1" />
                </svg>
              </span>
              <span id="check-icon-wrapper" class="hidden">
                <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5 mr-2" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2">
                  <path stroke-linecap="round" stroke-linejoin="round" d="M5 13l4 4L19 7" />
                </svg>
              </span>
              <span id="copy-handle-text"></span>
            </button>
            <a id="open-instagram-link" href="https://www.instagram.com/" target="_blank" rel="noopener noreferrer" class="w-full flex items-center justify-center bg-gradient-to-r from-[#833ab4] via-[#fd1d1d] to-[#fcb045] text-white font-bold py-3 px-4 rounded-xl shadow-md hover:opacity-90 transition-opacity">
              <svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2">
                <rect width="20" height="20" x="2" y="2" rx="5" ry="5" />
                <path d="M16 11.37A4 4 0 1 1 12.63 8 4 4 0 0 1 16 11.37z" />
                <line x1="17.5" y1="6.5" x2="17.51" y2="6.5" />
              </svg>
              <span class="ml-2">Open Instagram</span>
            </a>
          </div>
          <p class="text-xs text-gray-400 mt-4">Thanks for tagging! This helps other locals find us.</p>
        </div>
        
        <!-- Google Review Card -->
        <div id="google-review-card" class="bg-white rounded-2xl p-6 shadow-lg text-center">
            <div class="mx-auto bg-blue-100 text-white w-16 h-16 rounded-2xl flex items-center justify-center mb-4">
                <svg xmlns="http://www.w3.org/2000/svg" class="h-8 w-8 text-blue-500" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M17.657 16.657L13.414 20.9a1.998 1.998 0 01-2.827 0l-4.244-4.243a8 8 0 1111.314 0z" />
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 11a3 3 0 11-6 0 3 3 0 016 0z" />
                </svg>
            </div>
            <h2 id="review-card-title" class="text-2xl font-bold text-gray-800 mb-2">Enjoying your time?</h2>
            <p id="review-card-subtitle" class="text-gray-600 mb-6">Let us know how we're doing.</p>
            
            <a id="google-review-link" href="#" target="_blank" rel="noopener noreferrer" class="hidden"></a>

            <div id="review-initial-state">
                <div id="review-emoji-ratings" class="flex justify-center space-x-4">
                    <button class="text-4xl p-2 rounded-full transition-transform transform hover:scale-125 focus:outline-none" data-sentiment="negative">üò†</button>
                    <button class="text-4xl p-2 rounded-full transition-transform transform hover:scale-125 focus:outline-none" data-sentiment="negative">üòê</button>
                    <button class="text-4xl p-2 rounded-full transition-transform transform hover:scale-125 focus:outline-none" data-sentiment="positive">üòä</button>
                    <button class="text-4xl p-2 rounded-full transition-transform transform hover:scale-125 focus:outline-none" data-sentiment="positive">üòç</button>
                </div>
            </div>

            <div id="review-feedback-form" class="hidden">
                <form id="netlify-feedback-form" name="" method="POST" data-netlify="true">
                    <input id="netlify-form-name-input" type="hidden" name="form-name" value="" />
                    <textarea id="review-feedback-textarea" name="feedback_comment" rows="3" class="w-full p-3 border border-gray-300 rounded-xl focus:ring-2 focus:ring-[#004225] focus:border-transparent transition" placeholder="Tell us more..."></textarea>
                    <button id="review-submit-feedback-button" type="submit" class="mt-4 w-full bg-blue-500 text-white font-bold py-3 px-4 rounded-xl shadow-lg hover:bg-blue-600 transition-colors">
                        Submit Feedback
                    </button>
                </form>
            </div>

            <div id="review-feedback-thanks" class="hidden">
                <p class="text-xl font-semibold text-green-600">Thanks for your feedback!</p>
            </div>
        </div>
        
      </main>
      
      <!-- Footer -->
      <footer class="text-center py-4">
        <p class="text-sm text-gray-500">
          Powered by <span class="font-bold text-[#004225]">CoasterHub</span>
        </p>
      </footer>
    </div>
    
    <div id="error-container" class="hidden text-center p-8">
        <h1 class="text-2xl font-bold text-red-600 mb-4">Error</h1>
        <p id="error-message" class="text-gray-700"></p>
    </div>

    <!-- Hidden forms for Netlify build detection -->
    <div class="hidden">
        <form name="feedback-the-palace" netlify netlify-honeypot="bot-field" data-netlify="true">
            <input type="text" name="feedback_comment" />
        </form>
        <form name="feedback-royal-oak" netlify netlify-honeypot="bot-field" data-netlify="true">
            <input type="text" name="feedback_comment" />
        </form>
    </div>

    <!-- Spin Wheel Prize Modal -->
    <div id="prize-modal" class="hidden fixed inset-0 bg-black bg-opacity-60 flex items-center justify-center p-4 z-50">
        <div class="bg-white rounded-2xl p-8 shadow-2xl text-center max-w-sm w-full relative">
            
            <!-- Initial Prize View -->
            <div id="prize-initial-view">
                <h2 class="text-3xl font-bold text-purple-600 mb-2">Congratulations!</h2>
                <p class="text-gray-600 mb-4">You've won:</p>
                <div class="bg-gray-50 border-2 border-dashed border-gray-300 rounded-xl py-4 px-2 mb-6">
                    <p id="prize-won" class="text-2xl font-bold text-gray-800"></p>
                </div>
                <p class="text-sm text-gray-500 mb-6">Show this screen to staff to claim your prize.</p>
                <div class="space-y-3">
                    <button id="redeem-now-button" class="w-full bg-purple-600 text-white font-bold py-3 px-4 rounded-xl shadow-lg hover:bg-purple-700 transition-colors">
                        Redeem Now
                    </button>
                    <button id="redeem-later-button" class="w-full bg-gray-200 text-gray-700 font-bold py-3 px-4 rounded-xl hover:bg-gray-300 transition-colors">
                        Redeem Later
                    </button>
                </div>
                <div class="text-xs text-gray-400 mt-4 text-center">
                    <p id="prize-expiry" class="font-semibold"></p>
                </div>
            </div>

            <!-- Confirmation View -->
            <div id="prize-confirmation-view" class="hidden">
                <h2 class="text-2xl font-bold text-gray-800 mb-4">Before your proceed</h2>
                <p class="text-gray-600 mb-6">Have you shown this screen to a staff member? This prize can only be redeemed once.</p>
                <div class="space-y-3">
                    <button id="confirm-redemption-button" class="w-full bg-green-600 text-white font-bold py-3 px-4 rounded-xl shadow-lg hover:bg-green-700 transition-colors">
                        Yes, redeem now.
                    </button>
                    <button id="cancel-redemption-button" class="w-full bg-gray-200 text-gray-700 font-bold py-3 px-4 rounded-xl hover:bg-gray-300 transition-colors">
                        I'm not ready to redeem yet.
                    </button>
                </div>
            </div>

            <!-- Redeemed View -->
            <div id="prize-redeemed-view" class="hidden">
                <div class="mx-auto bg-green-100 w-16 h-16 rounded-full flex items-center justify-center mb-4">
                    <svg class="w-10 h-10 text-green-500" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M5 13l4 4L19 7"></path></svg>
                </div>
                <h2 class="text-3xl font-bold text-green-600 mb-2">Success!</h2>
                <p class="text-gray-600">Your prize has been redeemed.</p>
            </div>
        </div>
    </div>

    <!-- Stop The Clock Prize Modal -->
    <div id="stop-clock-prize-modal" class="hidden fixed inset-0 bg-black bg-opacity-60 flex items-center justify-center p-4 z-50">
        <div class="bg-white rounded-2xl p-8 shadow-2xl text-center max-w-sm w-full relative">
            <!-- Initial Prize View -->
            <div id="stop-clock-prize-initial-view">
                <h2 class="text-3xl font-bold text-pink-500 mb-2">You're a Winner!</h2>
                <p class="text-gray-600 mb-4">You've won:</p>
                <div class="bg-gray-50 border-2 border-dashed border-gray-300 rounded-xl py-4 px-2 mb-6">
                    <p id="stop-clock-prize-won" class="text-2xl font-bold text-gray-800"></p>
                </div>
                <p class="text-sm text-gray-500 mb-6">Show this screen to staff to claim your prize.</p>
                <div class="space-y-3">
                    <button id="stop-clock-redeem-now-button" class="w-full bg-pink-500 text-white font-bold py-3 px-4 rounded-xl shadow-lg hover:bg-pink-600 transition-colors">
                        Redeem Now
                    </button>
                    <button id="stop-clock-redeem-later-button" class="w-full bg-gray-200 text-gray-700 font-bold py-3 px-4 rounded-xl hover:bg-gray-300 transition-colors">
                        Redeem Later
                    </button>
                </div>
                <div class="text-xs text-gray-400 mt-4 text-center">
                    <p id="stop-clock-prize-expiry" class="font-semibold"></p>
                </div>
            </div>

            <!-- Confirmation View -->
            <div id="stop-clock-prize-confirmation-view" class="hidden">
                <h2 class="text-2xl font-bold text-gray-800 mb-4">Confirm Redemption</h2>
                <p class="text-gray-600 mb-6">Have you shown this screen to a staff member? This prize can only be redeemed once.</p>
                <div class="space-y-3">
                    <button id="stop-clock-confirm-redemption-button" class="w-full bg-green-600 text-white font-bold py-3 px-4 rounded-xl shadow-lg hover:bg-green-700 transition-colors">
                        Yes, redeem now
                    </button>
                    <button id="stop-clock-cancel-redemption-button" class="w-full bg-gray-200 text-gray-700 font-bold py-3 px-4 rounded-xl hover:bg-gray-300 transition-colors">
                        Cancel
                    </button>
                </div>
            </div>

            <!-- Redeemed View -->
            <div id="stop-clock-prize-redeemed-view" class="hidden">
                <div class="mx-auto bg-green-100 w-16 h-16 rounded-full flex items-center justify-center mb-4">
                    <svg class="w-10 h-10 text-green-500" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M5 13l4 4L19 7"></path></svg>
                </div>
                <h2 class="text-3xl font-bold text-green-600 mb-2">Success!</h2>
                <p class="text-gray-600">Your prize has been redeemed.</p>
            </div>
        </div>
    </div>

    <!-- Birthday Club Terms & Conditions Modal -->
    <div id="terms-modal" class="hidden fixed inset-0 bg-black bg-opacity-60 flex items-center justify-center p-4 z-50">
        <div class="bg-white rounded-2xl p-8 shadow-2xl text-left max-w-sm w-full relative">
            <h2 class="text-2xl font-bold text-gray-800 mb-4">Birthday Club Terms</h2>
            <div class="space-y-3 text-sm text-gray-600">
                <p><span class="font-semibold">Offer:</span> Limited to one free drink per person, per year during their birthday week.</p>
                <p><span class="font-semibold">Eligible Drinks:</span> The offer is valid for house beer, cider, house wine, or soft drink.</p>
                <p><span class="font-semibold">Serving Size:</span> Beer/cider is a schooner. Wine is a standard 150ml glass.</p>
                <p><span class="font-semibold">Redemption:</span> A valid ID must be shown to verify your date of birth. This offer cannot be exchanged for cash and is not valid with other promotions.</p>
            </div>
            <button id="close-terms-button" class="mt-6 w-full bg-gray-200 text-gray-700 font-bold py-3 px-4 rounded-xl hover:bg-gray-300 transition-colors">
                Close
            </button>
        </div>
    </div>

    <!-- Stop The Clock Terms Modal -->
    <div id="stop-clock-terms-modal" class="hidden fixed inset-0 bg-black bg-opacity-60 flex items-center justify-center p-4 z-50">
        <div class="bg-white rounded-2xl p-8 shadow-2xl text-left max-w-sm w-full relative">
            <h2 class="text-2xl font-bold text-gray-800 mb-4">Stop The Clock Terms</h2>
            <div class="space-y-3 text-sm text-gray-600">
                <p><span class="font-semibold">Prize:</span> One free pot of house beer or soft drink for stopping the clock at exactly 10.00 seconds.</p>
                <p><span class="font-semibold">Limits:</span> Limited to one win per person every 2 hours.</p>
                <p><span class="font-semibold">Redemption:</span> Prize must be redeemed on the same day. This offer cannot be exchanged for cash.</p>
            </div>
            <button id="close-stop-clock-terms-button" class="mt-6 w-full bg-gray-200 text-gray-700 font-bold py-3 px-4 rounded-xl hover:bg-gray-300 transition-colors">
                Close
            </button>
        </div>
    </div>

    <!-- Spin Wheel Terms Modal -->
    <div id="spin-wheel-terms-modal" class="hidden fixed inset-0 bg-black bg-opacity-60 flex items-center justify-center p-4 z-50">
        <div class="bg-white rounded-2xl p-8 shadow-2xl text-left max-w-sm w-full relative">
            <h2 class="text-2xl font-bold text-gray-800 mb-4">Spin To Win Terms</h2>
            <div class="space-y-3 text-sm text-gray-600">
                <p><span class="font-semibold">Prizes:</span> As stated on the wheel segment you land on.</p>
                <p><span class="font-semibold">Limits:</span> Limited to one spin per person every 2 hours.</p>
                <p><span class="font-semibold">Redemption:</span> Prize must be redeemed on the same day. This offer cannot be exchanged for cash and is not valid with other promotions.</p>
            </div>
            <button id="close-spin-wheel-terms-button" class="mt-6 w-full bg-gray-200 text-gray-700 font-bold py-3 px-4 rounded-xl hover:bg-gray-300 transition-colors">
                Close
            </button>
        </div>
    </div>

    <!-- Trivia Terms Modal -->
    <div id="trivia-terms-modal" class="hidden fixed inset-0 bg-black bg-opacity-60 flex items-center justify-center p-4 z-50">
        <div class="bg-white rounded-2xl p-8 shadow-2xl text-left max-w-sm w-full relative">
            <h2 class="text-2xl font-bold text-gray-800 mb-4">Trivia Terms</h2>
            <div class="space-y-3 text-sm text-gray-600">
                <p>The weekly trivia is for entertainment purposes only.</p>
                <p>No prize is awarded for participation or for achieving a high score.</p>
                <p>Challenge your friends and have fun!</p>
            </div>
            <button id="close-trivia-terms-button" class="mt-6 w-full bg-gray-200 text-gray-700 font-bold py-3 px-4 rounded-xl hover:bg-gray-300 transition-colors">
                Close
            </button>
        </div>
    </div>

    <script>
        // --- GLOBAL & CONSTANTS ---
let currentVenueDetails = null;

const AFL_TRIVIA_QUESTIONS = [
  { question: "Which club holds the record for the most VFL/AFL Premierships?", options: ["Carlton", "Collingwood", "Essendon", "Richmond"], correctAnswer: "Carlton" },
  { question: "Who has kicked the most goals in VFL/AFL history?", options: ["Gary Ablett Sr.", "Jason Dunstall", "Gordon Coventry", "Tony Lockett"], correctAnswer: "Tony Lockett" },
  { question: "Which player has won the most Brownlow Medals?", options: ["Dick Reynolds", "Haydn Bunton Sr.", "Ian Stewart", "Nat Fyfe"], correctAnswer: "Nat Fyfe" },
  { question: "What year was the Australian Football League (AFL) officially formed, succeeding the VFL?", options: ["1985", "1990", "1995", "2000"], correctAnswer: "1990" },
  { question: "Which team won the inaugural AFLW premiership in 2017?", options: ["Brisbane Lions", "Adelaide Crows", "Western Bulldogs", "Collingwood"], correctAnswer: "Adelaide Crows" },
  { question: "What is the nickname of the Hawthorn Football Club?", options: ["The Eagles", "The Hawks", "The Power", "The Suns"], correctAnswer: "The Hawks" },
  { question: "The 'Grand Final' is traditionally played at which stadium?", options: ["Optus Stadium", "The Gabba", "Adelaide Oval", "MCG"], correctAnswer: "MCG" },
  { question: "Who is the current CEO of the AFL?", options: ["Gillon McLachlan", "Andrew Dillon", "Eddie McGuire", "Jeff Kennett"], correctAnswer: "Andrew Dillon" },
  { question: "Which two teams compete in the 'Showdown'?", options: ["West Coast & Fremantle", "Sydney & GWS", "Adelaide & Port Adelaide", "Collingwood & Carlton"], correctAnswer: "Adelaide & Port Adelaide" },
  { question: "A 'torpedo' or 'torp' is a type of what in AFL?", options: ["Tackle", "Kick", "Handball", "Mark"], correctAnswer: "Kick" }
];

const WHEEL_PRIZES = [
    { text: "$10 off food when you spend $50+", minAngle: 0, maxAngle: 144 }, 
    { text: "Free chips with any drink purchase", minAngle: 144, maxAngle: 216 },
    { text: "Pay schooner price for a pint of your choice", minAngle: 216, maxAngle: 288 },
    { text: "Free soft drink", minAngle: 288, maxAngle: 360 },
];

const STOP_CLOCK_PRIZE = "A free pot of beer (or soft drink)";
const COOLDOWN_DURATION = 2 * 60 * 60 * 1000; // 2 hours in ms

// --- STATE ---
let currentQuestionIndex = 0, score = 0, isAnswered = false, isSpinning = false, currentRotation = 0, cooldownInterval;
let stopClockInterval = null, stopClockStartTime = 0, stopClockGameState = 'idle', stopClockCooldownInterval;
let triviaTimerInterval = null, triviaStartTime = 0;

// --- DOM ELEMENTS (cached once) ---
const getElement = (id) => document.getElementById(id);
const DOMElements = {
    appContainer: getElement('app-container'),
    errorContainer: getElement('error-container'),
    errorMessage: getElement('error-message'),
    pubLogo: getElement('pub-logo'),
    pubName: getElement('pub-name'),
    pubAddress: getElement('pub-address'),
    pubInstagramLink: getElement('pub-instagram-link'),
    pubFacebookLink: getElement('pub-facebook-link'),
    pubInstagramHandle: getElement('pub-instagram-handle'),
    copyHandleButton: getElement('copy-handle-button'),
    copyHandleText: getElement('copy-handle-text'),
    copyIconWrapper: getElement('copy-icon-wrapper'),
    checkIconWrapper: getElement('check-icon-wrapper'),
    openInstagramLink: getElement('open-instagram-link'),
    googleReviewLink: getElement('google-review-link'),
    stopClockTimer: getElement('stop-clock-timer'),
    stopClockResult: getElement('stop-clock-result'),
    stopClockButton: getElement('stop-clock-button'),
    showStopClockTermsButton: getElement('show-stop-clock-terms-button'),
    stopClockTermsModal: getElement('stop-clock-terms-modal'),
    closeStopClockTermsButton: getElement('close-stop-clock-terms-button'),
    stopClockPrizeModal: getElement('stop-clock-prize-modal'),
    stopClockPrizeWonText: getElement('stop-clock-prize-won'),
    stopClockPrizeExpiryEl: getElement('stop-clock-prize-expiry'),
    stopClockPrizeInitialView: getElement('stop-clock-prize-initial-view'),
    stopClockPrizeConfirmationView: getElement('stop-clock-prize-confirmation-view'),
    stopClockPrizeRedeemedView: getElement('stop-clock-prize-redeemed-view'),
    stopClockRedeemNowButton: getElement('stop-clock-redeem-now-button'),
    stopClockRedeemLaterButton: getElement('stop-clock-redeem-later-button'),
    stopClockConfirmRedemptionButton: getElement('stop-clock-confirm-redemption-button'),
    stopClockCancelRedemptionButton: getElement('stop-clock-cancel-redemption-button'),
    spinButton: getElement('spin-button'),
    wheel: getElement('wheel'),
    prizeModal: getElement('prize-modal'),
    prizeWonText: getElement('prize-won'),
    prizeExpiryEl: getElement('prize-expiry'),
    showSpinWheelTermsButton: getElement('show-spin-wheel-terms-button'),
    spinWheelTermsModal: getElement('spin-wheel-terms-modal'),
    closeSpinWheelTermsButton: getElement('close-spin-wheel-terms-button'),
    prizeInitialView: getElement('prize-initial-view'),
    prizeConfirmationView: getElement('prize-confirmation-view'),
    prizeRedeemedView: getElement('prize-redeemed-view'),
    redeemNowButton: getElement('redeem-now-button'),
    redeemLaterButton: getElement('redeem-later-button'),
    confirmRedemptionButton: getElement('confirm-redemption-button'),
    cancelRedemptionButton: getElement('cancel-redemption-button'),
    triviaStartScreen: getElement('trivia-start-screen'),
    triviaPlayingScreen: getElement('trivia-playing-screen'),
    triviaFinishedScreen: getElement('trivia-finished-screen'),
    startTriviaButton: getElement('start-trivia-button'),
    playAgainButton: getElement('play-again-button'),
    questionCounter: getElement('question-counter'),
    questionText: getElement('question-text'),
    answerOptionsContainer: getElement('answer-options'),
    finalScore: getElement('final-score'),
    totalQuestions: getElement('total-questions'),
    scorePercentage: getElement('score-percentage'),
    showTriviaTermsButton: getElement('show-trivia-terms-button'),
    triviaTermsModal: getElement('trivia-terms-modal'),
    closeTriviaTermsButton: getElement('close-trivia-terms-button'),
    triviaTimer: getElement('trivia-timer'),
    finalTimeDisplay: getElement('final-time-display'),
    reviewCardTitle: getElement('review-card-title'),
    reviewCardSubtitle: getElement('review-card-subtitle'),
    reviewInitialState: getElement('review-initial-state'),
    reviewEmojiButtons: document.querySelectorAll('#review-emoji-ratings button'),
    reviewFeedbackForm: getElement('review-feedback-form'),
    netlifyFeedbackForm: getElement('netlify-feedback-form'),
    netlifyFormNameInput: getElement('netlify-form-name-input'),
    reviewFeedbackThanks: getElement('review-feedback-thanks'),
    birthdayInitialView: getElement('birthday-initial-view'),
    birthdayThanksView: getElement('birthday-thanks-view'),
    birthdayForm: getElement('birthday-form'),
    birthdayEmailInput: getElement('birthday-email'),
    birthdayMonthInput: getElement('birthday-month'),
    birthdayDayInput: getElement('birthday-day'),
    birthdayError: getElement('birthday-error'),
    customMonthSelect: getElement('custom-month-select'),
    customMonthSelectButton: getElement('custom-month-select-button'),
    customMonthSelectValue: getElement('custom-month-select-value'),
    customMonthSelectOptions: getElement('custom-month-select-options'),
    showTermsButton: getElement('show-terms-button'),
    termsModal: getElement('terms-modal'),
    closeTermsButton: getElement('close-terms-button'),
};

// --- DYNAMIC DATA LOADING & UI POPULATION ---

function showError(message) {
    DOMElements.appContainer.classList.add('hidden');
    DOMElements.errorMessage.textContent = message;
    DOMElements.errorContainer.classList.remove('hidden');
}

function populateUI(details) {
    document.title = details.name;
    DOMElements.pubLogo.src = details.logo;
    DOMElements.pubLogo.alt = `${details.name} logo`;
    DOMElements.pubName.textContent = details.name;
    DOMElements.pubAddress.textContent = details.address;
    DOMElements.pubInstagramLink.href = details.instagramUrl;
    DOMElements.pubFacebookLink.href = details.facebookUrl;
    DOMElements.pubInstagramHandle.textContent = details.instagramHandle;
    DOMElements.copyHandleText.textContent = `Copy Handle ${details.instagramHandle}`;
    DOMElements.openInstagramLink.href = `https://www.instagram.com/${details.instagramHandle.substring(1)}/`;
    DOMElements.googleReviewLink.href = details.googleReviewLink;
    DOMElements.reviewCardTitle.textContent = `Enjoying your time at ${details.name}?`;
    
    // Configure Netlify form
    DOMElements.netlifyFeedbackForm.name = details.netlifyFormName;
    DOMElements.netlifyFormNameInput.value = details.netlifyFormName;
}

async function loadVenueData() {
    try {
        const urlParams = new URLSearchParams(window.location.search);
        const venueSlug = urlParams.get('venue');

        if (!venueSlug) {
            showError("No venue specified. Please use a valid link with a venue slug (e.g., ?venue=your-venue-name).");
            return false;
        }

        const response = await fetch('/venues.json');
        if (!response.ok) throw new Error('Could not load venue data.');
        
        const venues = await response.json();
        const details = venues[venueSlug];

        if (!details) {
            showError(`Venue "${venueSlug}" not found.`);
            return false;
        }
        
        currentVenueDetails = details;
        populateUI(details);
        return true;

    } catch (error) {
        console.error("Error loading venue data:", error);
        showError("Sorry, we couldn't load the page for this venue.");
        return false;
    }
}


// --- UTILITY FUNCTIONS ---

function copyHandleToClipboard() {
    navigator.clipboard.writeText(currentVenueDetails.instagramHandle).then(() => {
        DOMElements.copyHandleText.textContent = 'Copied!';
        DOMElements.copyIconWrapper.classList.add('hidden');
        DOMElements.checkIconWrapper.classList.remove('hidden');
        setTimeout(() => {
            DOMElements.copyHandleText.textContent = `Copy Handle ${currentVenueDetails.instagramHandle}`;
            DOMElements.copyIconWrapper.classList.remove('hidden');
            DOMElements.checkIconWrapper.classList.add('hidden');
        }, 2000);
    });
}

function formatTime(ms) {
    const totalSeconds = Math.max(0, Math.floor(ms / 1000));
    const hours = Math.floor(totalSeconds / 3600);
    const minutes = Math.floor((totalSeconds % 3600) / 60);
    const seconds = totalSeconds % 60;
    return `${hours.toString().padStart(2, '0')}:${minutes.toString().padStart(2, '0')}:${seconds.toString().padStart(2, '0')}`;
}

// --- STOP THE CLOCK GAME ---
function getActiveStopClockPrize() {
    const prizeData = localStorage.getItem('stopClockActivePrize');
    if (!prizeData) return null;
    try {
        const prize = JSON.parse(prizeData);
        if (Date.now() > prize.expiry) {
            localStorage.removeItem('stopClockActivePrize');
            return null;
        }
        return prize;
    } catch (e) { return null; }
}

function showStopClockPrizeModal() {
    const prize = getActiveStopClockPrize();
    if (!prize) return;
    DOMElements.stopClockPrizeWonText.textContent = prize.text;
    const expiryDate = new Date(prize.expiry);
    const dateOptions = { year: 'numeric', month: 'long', day: 'numeric' };
    const timeOptions = { hour: 'numeric', minute: '2-digit', hour12: true };
    DOMElements.stopClockPrizeExpiryEl.textContent = `Offer expires: ${expiryDate.toLocaleDateString('en-AU', dateOptions)} at ${expiryDate.toLocaleTimeString('en-AU', timeOptions)}`;
    DOMElements.stopClockPrizeInitialView.classList.remove('hidden');
    DOMElements.stopClockPrizeConfirmationView.classList.add('hidden');
    DOMElements.stopClockPrizeRedeemedView.classList.add('hidden');
    DOMElements.stopClockPrizeModal.classList.remove('hidden');
}
function hideStopClockPrizeModal() { DOMElements.stopClockPrizeModal.classList.add('hidden'); }
function startStopClockCooldownTimer(expiryTime) {
    if (stopClockCooldownInterval) clearInterval(stopClockCooldownInterval);
    DOMElements.stopClockButton.disabled = true;
    const activePrize = getActiveStopClockPrize();
    stopClockCooldownInterval = setInterval(() => {
        const timeLeft = expiryTime - Date.now();
        if (timeLeft <= 0) {
            clearInterval(stopClockCooldownInterval);
            DOMElements.stopClockButton.disabled = false;
            localStorage.removeItem('stopClockActivePrize');
            resetStopClock();
        } else {
            if (activePrize && !activePrize.redeemed) {
                DOMElements.stopClockButton.textContent = 'View Your Prize';
                DOMElements.stopClockButton.disabled = false;
                DOMElements.stopClockButton.classList.remove('bg-pink-500', 'hover:bg-pink-600', 'bg-gray-400');
                DOMElements.stopClockButton.classList.add('bg-purple-600', 'hover:bg-purple-700');
                clearInterval(stopClockCooldownInterval);
                return;
            }
            DOMElements.stopClockButton.textContent = `Play again in ${formatTime(timeLeft)}`;
        }
    }, 1000);
    const timeLeft = expiryTime - Date.now();
    if (timeLeft > 0) {
        if (activePrize && !activePrize.redeemed) {
            DOMElements.stopClockButton.textContent = 'View Your Prize';
            DOMElements.stopClockButton.disabled = false;
            DOMElements.stopClockButton.classList.remove('bg-pink-500', 'hover:bg-pink-600', 'bg-gray-400');
            DOMElements.stopClockButton.classList.add('bg-purple-600', 'hover:bg-purple-700');
        } else {
            DOMElements.stopClockButton.textContent = `Play again in ${formatTime(timeLeft)}`;
        }
    }
}
function handleStopClockRedeemLater() { hideStopClockPrizeModal(); const prize = getActiveStopClockPrize(); if (prize && !prize.redeemed) startStopClockCooldownTimer(prize.expiry); }
function handleStopClockRedeemNow() { DOMElements.stopClockPrizeInitialView.classList.add('hidden'); DOMElements.stopClockPrizeConfirmationView.classList.remove('hidden'); }
function handleStopClockCancelRedemption() { DOMElements.stopClockPrizeConfirmationView.classList.add('hidden'); DOMElements.stopClockPrizeInitialView.classList.remove('hidden'); }
function handleStopClockConfirmRedemption() {
    let prize = getActiveStopClockPrize();
    if (prize) {
        prize.redeemed = true;
        localStorage.setItem('stopClockActivePrize', JSON.stringify(prize));
        DOMElements.stopClockPrizeConfirmationView.classList.add('hidden');
        DOMElements.stopClockPrizeRedeemedView.classList.remove('hidden');
        setTimeout(() => { hideStopClockPrizeModal(); startStopClockCooldownTimer(prize.expiry); }, 2500);
    }
}
function updateStopClockTimer() { const elapsedTime = Date.now() - stopClockStartTime; DOMElements.stopClockTimer.textContent = (elapsedTime / 1000).toFixed(2); }
function startStopClock() {
    stopClockStartTime = Date.now();
    DOMElements.stopClockResult.textContent = '';
    stopClockInterval = setInterval(updateStopClockTimer, 10);
    DOMElements.stopClockButton.textContent = 'Stop!';
    DOMElements.stopClockButton.classList.remove('bg-pink-500', 'hover:bg-pink-600');
    DOMElements.stopClockButton.classList.add('bg-red-500', 'hover:bg-red-600');
    stopClockGameState = 'running';
}
function stopStopClock() {
    clearInterval(stopClockInterval);
    const finalTime = parseFloat(DOMElements.stopClockTimer.textContent);
    if (finalTime.toFixed(2) === '10.00') {
        DOMElements.stopClockResult.textContent = 'Perfect timing! You won! üèÜ';
        DOMElements.stopClockResult.classList.add('text-green-600');
        DOMElements.stopClockResult.classList.remove('text-gray-700');
        const expiryTime = Date.now() + COOLDOWN_DURATION;
        const prizeData = { text: STOP_CLOCK_PRIZE, expiry: expiryTime, redeemed: false };
        localStorage.setItem('stopClockActivePrize', JSON.stringify(prizeData));
        setTimeout(() => { showStopClockPrizeModal(); startStopClockCooldownTimer(expiryTime); }, 500);
    } else {
        DOMElements.stopClockResult.textContent = `So close! You stopped at ${finalTime.toFixed(2)}s.`;
        DOMElements.stopClockResult.classList.add('text-gray-700');
        DOMElements.stopClockResult.classList.remove('text-green-600');
        DOMElements.stopClockButton.textContent = 'Play Again';
        DOMElements.stopClockButton.classList.remove('bg-red-500', 'hover:bg-red-600');
        DOMElements.stopClockButton.classList.add('bg-gray-500', 'hover:bg-gray-600');
        stopClockGameState = 'stopped';
    }
}
function resetStopClock() {
    DOMElements.stopClockTimer.textContent = '0.00';
    DOMElements.stopClockResult.textContent = '';
    DOMElements.stopClockButton.textContent = 'Start';
    DOMElements.stopClockButton.disabled = false;
    DOMElements.stopClockButton.classList.remove('bg-gray-500', 'hover:bg-gray-600', 'bg-purple-600', 'hover:bg-purple-700', 'bg-gray-400');
    DOMElements.stopClockButton.classList.add('bg-pink-500', 'hover:bg-pink-600');
    stopClockGameState = 'idle';
}
function handleStopClockButtonClick() {
    const prize = getActiveStopClockPrize();
    if (prize && !prize.redeemed) { showStopClockPrizeModal(); return; }
    if (DOMElements.stopClockButton.disabled) return;
    if (stopClockGameState === 'idle') startStopClock();
    else if (stopClockGameState === 'running') stopStopClock();
    else resetStopClock();
}

// --- SPIN WHEEL GAME ---
function formatSpinTime(ms) { const totalSeconds = Math.max(0, Math.floor(ms / 1000)); const hours = Math.floor(totalSeconds / 3600); const minutes = Math.floor((totalSeconds % 3600) / 60); const seconds = totalSeconds % 60; return `Spin again in ${hours.toString().padStart(2, '0')}:${minutes.toString().padStart(2, '0')}:${seconds.toString().padStart(2, '0')}`; }
function startCooldownTimer(expiryTime) { if (cooldownInterval) clearInterval(cooldownInterval); isSpinning = true; DOMElements.spinButton.disabled = true; const activePrize = getActivePrize(); cooldownInterval = setInterval(() => { const now = Date.now(); const timeLeft = expiryTime - now; if (timeLeft <= 0) { clearInterval(cooldownInterval); DOMElements.spinButton.disabled = false; DOMElements.spinButton.textContent = 'Spin!'; isSpinning = false; localStorage.removeItem('activePrize'); } else { if (activePrize && !activePrize.redeemed) { DOMElements.spinButton.textContent = 'View Your Prize'; DOMElements.spinButton.disabled = false; DOMElements.spinButton.onclick = showPrizeModal; clearInterval(cooldownInterval); return; } DOMElements.spinButton.textContent = formatSpinTime(timeLeft); } }, 1000); const timeLeft = expiryTime - Date.now(); if (timeLeft > 0) { if (activePrize && !activePrize.redeemed) { DOMElements.spinButton.textContent = 'View Your Prize'; DOMElements.spinButton.disabled = false; DOMElements.spinButton.onclick = showPrizeModal; } else { DOMElements.spinButton.textContent = formatSpinTime(timeLeft); } } }
function spinTheWheel() { if (isSpinning) return; const expiryTime = Date.now() + COOLDOWN_DURATION; isSpinning = true; DOMElements.spinButton.disabled = true; DOMElements.spinButton.textContent = 'Spinning...'; DOMElements.spinButton.onclick = null; const randomStopAngle = Math.floor(Math.random() * 360); const fullRotations = 5; const newRotation = (fullRotations * 360) + randomStopAngle; currentRotation += newRotation; DOMElements.wheel.style.transform = `rotate(${currentRotation}deg)`; DOMElements.wheel.addEventListener('transitionend', () => { const effectiveAngle = (360 - (currentRotation % 360)) % 360; const prize = WHEEL_PRIZES.find(p => effectiveAngle >= p.minAngle && effectiveAngle < p.maxAngle); const prizeData = { text: prize ? prize.text : "Try Again!", expiry: expiryTime, redeemed: false }; localStorage.setItem('activePrize', JSON.stringify(prizeData)); showPrizeModal(); startCooldownTimer(expiryTime); }, { once: true }); }
function getActivePrize() { const prizeData = localStorage.getItem('activePrize'); if (!prizeData) return null; try { const prize = JSON.parse(prizeData); if (Date.now() > prize.expiry) { localStorage.removeItem('activePrize'); return null; } return prize; } catch (e) { return null; } }
function showPrizeModal() { const prize = getActivePrize(); if (!prize) return; DOMElements.prizeWonText.textContent = prize.text; const expiryDate = new Date(prize.expiry); const dateOptions = { year: 'numeric', month: 'long', day: 'numeric' }; const timeOptions = { hour: 'numeric', minute: '2-digit', hour12: true }; DOMElements.prizeExpiryEl.textContent = `Offer expires: ${expiryDate.toLocaleDateString('en-AU', dateOptions)} at ${expiryDate.toLocaleTimeString('en-AU', timeOptions)}`; DOMElements.prizeInitialView.classList.remove('hidden'); DOMElements.prizeConfirmationView.classList.add('hidden'); DOMElements.prizeRedeemedView.classList.add('hidden'); DOMElements.prizeModal.classList.remove('hidden'); }
function hidePrizeModal() { DOMElements.prizeModal.classList.add('hidden'); }
function handleRedeemLater() { hidePrizeModal(); const prize = getActivePrize(); if (prize && !prize.redeemed) { DOMElements.spinButton.textContent = 'View Your Prize'; DOMElements.spinButton.disabled = false; DOMElements.spinButton.onclick = showPrizeModal; } }
function handleRedeemNow() { DOMElements.prizeInitialView.classList.add('hidden'); DOMElements.prizeConfirmationView.classList.remove('hidden'); }
function handleCancelRedemption() { DOMElements.prizeConfirmationView.classList.add('hidden'); DOMElements.prizeInitialView.classList.remove('hidden'); }
function handleConfirmRedemption() { let prize = getActivePrize(); if (prize) { prize.redeemed = true; localStorage.setItem('activePrize', JSON.stringify(prize)); DOMElements.prizeConfirmationView.classList.add('hidden'); DOMElements.prizeRedeemedView.classList.remove('hidden'); setTimeout(() => { hidePrizeModal(); startCooldownTimer(prize.expiry); }, 2500); } }

// --- TRIVIA GAME ---
function displayQuestion() { isAnswered = false; const currentQuestion = AFL_TRIVIA_QUESTIONS[currentQuestionIndex]; DOMElements.questionCounter.textContent = `${currentQuestionIndex + 1}/${AFL_TRIVIA_QUESTIONS.length}`; DOMElements.questionText.textContent = currentQuestion.question; DOMElements.answerOptionsContainer.innerHTML = ''; currentQuestion.options.forEach(option => { const button = document.createElement('button'); button.textContent = option; button.className = 'w-full text-left p-4 rounded-xl font-medium transition-all duration-300 bg-gray-100 hover:bg-gray-200 text-gray-800'; button.addEventListener('click', () => selectAnswer(option, currentQuestion.correctAnswer, button)); DOMElements.answerOptionsContainer.appendChild(button); }); }
function selectAnswer(selectedOption, correctAnswer, buttonElement) { if (isAnswered) return; isAnswered = true; const isCorrect = selectedOption === correctAnswer; if (isCorrect) score++; const allOptionButtons = DOMElements.answerOptionsContainer.querySelectorAll('button'); allOptionButtons.forEach(btn => { btn.disabled = true; if (btn.textContent === correctAnswer) { btn.className = 'w-full text-left p-4 rounded-xl font-medium transition-all duration-300 bg-green-500 text-white animate-pulse'; } else if (btn.textContent === selectedOption && !isCorrect) { btn.className = 'w-full text-left p-4 rounded-xl font-medium transition-all duration-300 bg-red-500 text-white'; } else { btn.className = 'w-full text-left p-4 rounded-xl font-medium transition-all duration-300 bg-gray-100 text-gray-500 opacity-70'; } }); setTimeout(() => { currentQuestionIndex++; if (currentQuestionIndex < AFL_TRIVIA_QUESTIONS.length) { displayQuestion(); } else { endGame(); } }, 1200); }
function startGame() { currentQuestionIndex = 0; score = 0; DOMElements.triviaStartScreen.classList.add('hidden'); DOMElements.triviaFinishedScreen.classList.add('hidden'); DOMElements.triviaPlayingScreen.classList.remove('hidden'); DOMElements.triviaTimer.textContent = '0.00s'; DOMElements.finalTimeDisplay.textContent = ''; triviaStartTime = Date.now(); triviaTimerInterval = setInterval(() => { const elapsedTime = ((Date.now() - triviaStartTime) / 1000).toFixed(2); DOMElements.triviaTimer.textContent = `${elapsedTime}s`; }, 10); displayQuestion(); }
function endGame() { clearInterval(triviaTimerInterval); const finalTime = ((Date.now() - triviaStartTime) / 1000).toFixed(2); const percentage = Math.round((score / AFL_TRIVIA_QUESTIONS.length) * 100); DOMElements.finalScore.textContent = score; DOMElements.totalQuestions.textContent = AFL_TRIVIA_QUESTIONS.length; DOMElements.scorePercentage.textContent = `(${percentage}%)`; DOMElements.finalTimeDisplay.innerHTML = `Your time: <span class="font-bold text-gray-800">${finalTime}s</span>`; DOMElements.triviaPlayingScreen.classList.add('hidden'); DOMElements.triviaFinishedScreen.classList.remove('hidden'); }
function restartGame() { if (triviaTimerInterval) clearInterval(triviaTimerInterval); DOMElements.triviaFinishedScreen.classList.add('hidden'); DOMElements.triviaStartScreen.classList.remove('hidden'); }

// --- REVIEW/FEEDBACK ---
function handleReviewEmojiClick(event) {
    const sentiment = event.currentTarget.dataset.sentiment;
    if (sentiment === 'positive') {
        window.open(DOMElements.googleReviewLink.href, '_blank', 'noopener,noreferrer');
    } else {
        DOMElements.reviewInitialState.classList.add('hidden');
        DOMElements.reviewCardTitle.textContent = 'Tell us about your visit';
        DOMElements.reviewCardSubtitle.textContent = 'Your feedback is valuable to us.';
        DOMElements.reviewFeedbackForm.classList.remove('hidden');
    }
}

function submitPrivateFeedback(event) {
    event.preventDefault();
    const form = event.target;
    const formData = new FormData(form);
    const submitButton = form.querySelector('button[type="submit"]');
    const originalButtonText = submitButton.textContent;
    submitButton.disabled = true;
    submitButton.textContent = 'Submitting...';

    fetch('/', {
        method: 'POST',
        headers: { 'Content-Type': 'application/x-www-form-urlencoded' },
        body: new URLSearchParams(formData).toString()
    })
    .then(() => {
        DOMElements.reviewFeedbackForm.classList.add('hidden');
        DOMElements.reviewCardTitle.textContent = 'Thank You!';
        DOMElements.reviewCardSubtitle.classList.add('hidden');
        DOMElements.reviewFeedbackThanks.classList.remove('hidden');
    })
    .catch(error => {
        console.error('Error submitting feedback to Netlify:', error);
        alert('Sorry, there was an issue submitting your feedback. Please try again.');
    })
    .finally(() => {
        submitButton.disabled = false;
        submitButton.textContent = originalButtonText;
    });
}

// --- BIRTHDAY CLUB ---
function handleBirthdaySignup(event) {
    event.preventDefault();
    DOMElements.birthdayError.textContent = '';
    const submitButton = getElement('birthday-submit-button');
    const originalButtonText = submitButton.textContent;
    submitButton.disabled = true;
    submitButton.textContent = 'Signing Up...';

    const email = DOMElements.birthdayEmailInput.value;
    const month = parseInt(DOMElements.birthdayMonthInput.value, 10);
    const day = parseInt(DOMElements.birthdayDayInput.value, 10);
    
    // Validation logic... (unchanged)
    const emailRegex = /^[^\s@]+@[^\s@]+\.[^\s@]+$/;
    if (!email || !emailRegex.test(email)) {
        DOMElements.birthdayError.textContent = 'Please enter a valid email address.';
        submitButton.disabled = false; submitButton.textContent = originalButtonText; return;
    }
    if (DOMElements.birthdayMonthInput.value === "") {
        DOMElements.birthdayError.textContent = 'Please select your birth month.';
        submitButton.disabled = false; submitButton.textContent = originalButtonText; return;
    }
    if (!day || day < 1 || day > 31) {
        DOMElements.birthdayError.textContent = 'Please enter a valid day (1-31).';
        submitButton.disabled = false; submitButton.textContent = originalButtonText; return;
    }
    // End validation...

    const mailchimpConfig = currentVenueDetails.mailchimp;
    const params = new URLSearchParams({
        EMAIL: email,
        'BIRTHDAY[month]': month,
        'BIRTHDAY[day]': day,
        'tags': mailchimpConfig.tagId,
        [mailchimpConfig.botField]: ''
    });

    const callbackName = `jsonp_callback_${Date.now()}`;
    const url = `${mailchimpConfig.url}&${params.toString()}&c=${callbackName}`;
    
    const script = document.createElement('script');
    script.src = url;
    document.head.appendChild(script);

    window[callbackName] = (data) => {
        delete window[callbackName];
        document.head.removeChild(script);
        submitButton.disabled = false;
        submitButton.textContent = originalButtonText;

        if (data.result === 'success') {
            localStorage.setItem(`birthdayClubSignedUp_${currentVenueDetails.name}`, 'true');
            DOMElements.birthdayInitialView.classList.add('hidden');
            DOMElements.birthdayThanksView.classList.remove('hidden');
        } else {
            const errorMessage = data.msg.replace(/<[^>]*>?/gm, '').replace(/^\d+\s-\s/, '');
            DOMElements.birthdayError.textContent = errorMessage;
        }
    };
}

// --- EVENT LISTENERS ---
function addEventListeners() {
    DOMElements.copyHandleButton.addEventListener('click', copyHandleToClipboard);
    DOMElements.startTriviaButton.addEventListener('click', startGame);
    DOMElements.playAgainButton.addEventListener('click', restartGame);
    DOMElements.reviewEmojiButtons.forEach(button => button.addEventListener('click', handleReviewEmojiClick));
    DOMElements.netlifyFeedbackForm.addEventListener('submit', submitPrivateFeedback);
    if (localStorage.getItem(`birthdayClubSignedUp_${currentVenueDetails.name}`) === 'true') {
        DOMElements.birthdayInitialView.classList.add('hidden');
        DOMElements.birthdayThanksView.classList.remove('hidden');
    } else {
        DOMElements.birthdayForm.addEventListener('submit', handleBirthdaySignup);
        DOMElements.customMonthSelectButton.addEventListener('click', () => {
            const isExpanded = DOMElements.customMonthSelectButton.getAttribute('aria-expanded') === 'true';
            DOMElements.customMonthSelectButton.setAttribute('aria-expanded', String(!isExpanded));
            DOMElements.customMonthSelectOptions.classList.toggle('hidden');
        });
        DOMElements.customMonthSelectOptions.querySelectorAll('li').forEach(option => {
            option.addEventListener('click', () => {
                DOMElements.customMonthSelectValue.textContent = option.textContent;
                DOMElements.customMonthSelectButton.classList.remove('text-gray-500');
                DOMElements.birthdayMonthInput.value = option.dataset.value;
                DOMElements.customMonthSelectOptions.classList.add('hidden');
                DOMElements.customMonthSelectButton.setAttribute('aria-expanded', 'false');
            });
        });
        document.addEventListener('click', (event) => {
            if (!DOMElements.customMonthSelect.contains(event.target)) {
                DOMElements.customMonthSelectOptions.classList.add('hidden');
                DOMElements.customMonthSelectButton.setAttribute('aria-expanded', 'false');
            }
        });
    }
    
    // Modal Listeners
    const setupModal = (button, modal, closeButton) => {
        button.addEventListener('click', () => modal.classList.remove('hidden'));
        closeButton.addEventListener('click', () => modal.classList.add('hidden'));
        modal.addEventListener('click', e => { if (e.target === modal) modal.classList.add('hidden'); });
    };
    setupModal(DOMElements.showTermsButton, DOMElements.termsModal, DOMElements.closeTermsButton);
    setupModal(DOMElements.showStopClockTermsButton, DOMElements.stopClockTermsModal, DOMElements.closeStopClockTermsButton);
    setupModal(DOMElements.showSpinWheelTermsButton, DOMElements.spinWheelTermsModal, DOMElements.closeSpinWheelTermsButton);
    setupModal(DOMElements.showTriviaTermsButton, DOMElements.triviaTermsModal, DOMElements.closeTriviaTermsButton);

    // Game Listeners
    DOMElements.stopClockButton.addEventListener('click', handleStopClockButtonClick);
    DOMElements.stopClockRedeemLaterButton.addEventListener('click', handleStopClockRedeemLater);
    DOMElements.stopClockRedeemNowButton.addEventListener('click', handleStopClockRedeemNow);
    DOMElements.stopClockCancelRedemptionButton.addEventListener('click', handleStopClockCancelRedemption);
    DOMElements.stopClockConfirmRedemptionButton.addEventListener('click', handleStopClockConfirmRedemption);
    const activeStopClockPrize = getActiveStopClockPrize();
    if (activeStopClockPrize) startStopClockCooldownTimer(activeStopClockPrize.expiry);

    DOMElements.spinButton.addEventListener('click', spinTheWheel);
    DOMElements.redeemLaterButton.addEventListener('click', handleRedeemLater);
    DOMElements.redeemNowButton.addEventListener('click', handleRedeemNow);
    DOMElements.cancelRedemptionButton.addEventListener('click', handleCancelRedemption);
    DOMElements.confirmRedemptionButton.addEventListener('click', handleConfirmRedemption);
    const activePrize = getActivePrize();
    if (activePrize) startCooldownTimer(activePrize.expiry);
}

// --- APP INITIALIZATION ---
document.addEventListener('DOMContentLoaded', async () => {
    const loadedSuccessfully = await loadVenueData();
    if (loadedSuccessfully) {
        addEventListeners();
    }
});
    </script>
  </body>
</html>
